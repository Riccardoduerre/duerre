<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .portfolio-preview {
            background-size: cover;
            background-position: center;
            position: relative;
            cursor: pointer;
        }

        .portfolio-preview::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            transition: background-color 0.3s ease;
        }

        .portfolio-preview:hover::after {
            background-color: rgba(0, 0, 0, 0.2);
        }

        .portfolio-preview-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="navbar-container"></div>


    <section class="py-20 md:py-32 bg-neutral-900 text-white min-h-screen">
        <div class="container mx-auto px-4 md:px-8 text-center">
            <h2 class="text-3xl md:text-5xl font-bold uppercase tracking-widest mb-16" data-i18n="portfolio_heading">My Portfolio</h2>
            <div class="flex flex-col md:flex-row justify-center space-y-8 md:space-y-0 md:space-x-12">
                
                <a href="photos.html" class="relative block w-full md:w-1/2 lg:w-1/3 h-64 rounded-lg shadow-lg overflow-hidden portfolio-preview" style="background-image: url('https://raw.githubusercontent.com/Riccardoduerre/duerre/main/images/_DSC2241.jpg');">
                    <div class="portfolio-preview-text">
                        <span class="text-white text-3xl font-bold uppercase tracking-widest" data-i18n="photos_label">Photos</span>
                    </div>
                </a>

                <a href="videos.html" class="relative block w-full md:w-1/2 lg:w-1/3 h-64 rounded-lg shadow-lg overflow-hidden portfolio-preview" style="background-image: url('https://raw.githubusercontent.com/Riccardoduerre/duerre/main/images/_RIK7376_HDR.jpg');">
                    <div class="portfolio-preview-text">
                        <span class="text-white text-3xl font-bold uppercase tracking-widest" data-i18n="videos_label">Videos</span>
                    </div>
                </a>
                
            </div>
        </div>
    </section>

    <!-- Footer (injected) -->
    <div id="footer-container"></div>
    <script src="i18n.js"></script>
    <script src="navbar/loadNavbar.js"></script>
    <script>
        async function updatePortfolioPreviews() {
            const previews = document.querySelectorAll('.portfolio-preview');
            const placeholder = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='9'><rect width='16' height='9' fill='%23222222'/></svg>";
            for (const preview of previews) {
                // set a neutral low-res placeholder immediately
                preview.style.backgroundImage = `url('${placeholder}')`;
                const link = preview.closest('a') ? preview.closest('a').getAttribute('href') : preview.getAttribute('data-link');
                if (!link) continue;
                try {
                    console.debug('[portfolio] fetching', link);
                    const resp = await fetch(link);
                    const html = await resp.text();
                    const tmp = document.createElement('div');
                    tmp.innerHTML = html;

                    // Prefer first image
                    let firstImg = tmp.querySelector('img');
                    if (firstImg && firstImg.src) {
                        preview.style.backgroundImage = `url('${firstImg.src}')`;
                        continue;
                    }

                    // If no image, look for internal links and try them (deep search)
                    const innerLink = tmp.querySelector('a[href]');
                    if (innerLink && innerLink.getAttribute('href')) {
                        const innerHref = innerLink.getAttribute('href');
                        try {
                            const resp2 = await fetch(innerHref);
                            if (resp2.ok) {
                                const html2 = await resp2.text();
                                const tmp2 = document.createElement('div');
                                tmp2.innerHTML = html2;
                                firstImg = tmp2.querySelector('img');
                                if (firstImg && firstImg.src) {
                                    preview.style.backgroundImage = `url('${firstImg.src}')`;
                                    continue;
                                }
                                const video2 = tmp2.querySelector('video');
                                if (video2) {
                                    const poster2 = video2.getAttribute('poster');
                                    if (poster2) {
                                        preview.style.backgroundImage = `url('${poster2}')`;
                                        continue;
                                    }
                                }
                            }
                        } catch (e) {
                            // ignore inner fetch errors
                        }
                    }

                    // If there's a video with poster, use poster
                    const video = tmp.querySelector('video');
                    if (video) {
                        const poster = video.getAttribute('poster');
                        if (poster) {
                            preview.style.backgroundImage = `url('${poster}')`;
                            continue;
                        }

                        // Try to capture first frame (best-effort; may fail due to CORS)
                        try {
                            const src = video.querySelector('source') ? video.querySelector('source').src : video.src;
                            if (src) {
                                const captured = await captureVideoFrame(src);
                                if (captured) {
                                    preview.style.backgroundImage = `url('${captured}')`;
                                    continue;
                                }
                            }
                        } catch (err) {
                            console.warn('[portfolio] could not capture video frame', err);
                        }
                    }

                    // Fallback: look for iframe (e.g., YouTube) and use provider thumbnail if possible
                    const iframe = tmp.querySelector('iframe');
                    if (iframe && iframe.src) {
                        const thumb = youtubeThumbnailFromUrl(iframe.src);
                        if (thumb) {
                            preview.style.backgroundImage = `url('${thumb}')`;
                            continue;
                        }
                    }

                    console.debug('[portfolio] no media found for', link);
                } catch (err) {
                    console.error('[portfolio] fetch failed for', link, err);
                }
            }
        }

        function youtubeThumbnailFromUrl(url) {
            try {
                const u = new URL(url);
                if (u.hostname.includes('youtube') || u.hostname.includes('youtu.be')) {
                    // get video id
                    let id = null;
                    if (u.hostname === 'youtu.be') id = u.pathname.slice(1);
                    else id = u.searchParams.get('v');
                    if (id) return `https://img.youtube.com/vi/${id}/hqdefault.jpg`;
                }
            } catch (e) {
                return null;
            }
            return null;
        }

        function captureVideoFrame(src) {
            return new Promise((resolve, reject) => {
                const video = document.createElement('video');
                video.crossOrigin = 'anonymous';
                video.src = src;
                video.muted = true;
                video.playsInline = true;
                video.addEventListener('loadeddata', () => {
                    try {
                        // seek to a tiny offset to ensure frame available
                        video.currentTime = 0.1;
                    } catch (e) {
                        // some browsers require play to seek; try play
                    }
                });
                video.addEventListener('seeked', () => {
                    try {
                        const canvas = document.createElement('canvas');
                        canvas.width = video.videoWidth || 320;
                        canvas.height = video.videoHeight || 180;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                        const data = canvas.toDataURL('image/jpeg');
                        resolve(data);
                    } catch (err) {
                        reject(err);
                    }
                });
                video.addEventListener('error', (e) => reject(e));
                // Some browsers require play to trigger loadeddata/seek; try play then pause
                video.play().then(() => video.pause()).catch(() => {/* ignore autoplay errors */});
                // timeout fallback
                setTimeout(() => resolve(null), 3000);
            });
        }

        // Run after i18n ready and on language change
        window.addEventListener('i18nReady', updatePortfolioPreviews);
        window.addEventListener('languageChanged', updatePortfolioPreviews);
        document.addEventListener('DOMContentLoaded', () => {
            if (window.i18nReady) updatePortfolioPreviews();
        });
    </script>
</body>
</html>